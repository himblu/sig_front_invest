<div class="animated fadeIn fast">

    <mat-stepper #stepper class="mat-elevation-z2 custom-header" orientation="vertical" [linear]="false"  [formGroup]="form">

      <mat-step [stepControl]="form | stepFormGroup : 1" [editable]="true">

        <ng-template matStepLabel><span class="step-label">DATOS PERSONALES DEL GRUPO FAMILIAR</span></ng-template>

        <form [formGroup]="form | stepFormGroup : 1">
          <div class="mt-4">
            <div formArrayName="familyInformation">
              <div class="row">
                <div class="col-3">
                  <mat-checkbox class="example-margin" (change)="checkClick($event, 1)">¿Usted vive con su papá?</mat-checkbox>
                </div>
                <div class="col-3">
                  <mat-checkbox class="example-margin" (change)="checkClick($event, 2)">¿Usted vive con su mamá?</mat-checkbox>
                </div>
              </div>
              <ng-container *ngFor="let item of familyInformationFormArray.controls; let index = index;">
                <h5 class="font-bold" *ngIf="index+1 === 1">Información del Padre</h5>
                <h5 class="font-bold" *ngIf="index+1 === 2">Información de la Madre</h5>
                <div class="row" [formGroupName]="index">
                  <div class="col-3">
                    <mat-form-field appearance="outline">
                      <mat-label>Parentesco</mat-label>
                      <mat-select formControlName="relationship" #relationship [disabled]="relationship.value">
                        <mat-option *ngFor="let relationship of relationships; trackBy: trackByRelationshipId" [value]="relationship.relationShipID">
                          {{ relationship.relationName }}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>

                  <div class="col-3">
                    <mat-form-field appearance="outline">
                      <mat-label>Profesión/Ocupación</mat-label>
                      <mat-select formControlName="profession">
                        <mat-option *ngFor="let profession of professions; trackBy: trackByProfessionId" [value]="profession.professionID">
                          {{ profession.professionName }}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>

                  <div class="col-3">
                    <mat-form-field appearance="outline">
                      <mat-label>Instrucción</mat-label>
                      <mat-select formControlName="academicLevel">
                        <mat-option *ngFor="let academicLevel of academicLevels; trackBy: trackByAcademicLevelId" [value]="academicLevel.academicInstructionID">
                          {{ academicLevel.academicInstructionName }}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>

                  <div class="col-3">
                    <mat-form-field appearance="outline">
                      <mat-label *ngIf="index+1 === 1">Nombre del Padre</mat-label>
                      <mat-label *ngIf="index+1 === 2">Nombre de la Madre</mat-label>
                      <input matInput formControlName="familyMemberNames">
                    </mat-form-field>
                  </div>
                </div>
              </ng-container>
            </div>
          </div>
        </form>
        <div class="d-flex justify-content-end" style="text-align: right;">
          <button mat-raised-button class="blue-button" matStepperNext>Siguiente</button>
        </div>
      </mat-step>

      <mat-step [stepControl]="form | stepFormGroup : 2" [editable]="true">

        <ng-template matStepLabel><span class="step-label">REGISTRO DEL GRUPO FAMILIAR ACTUAL Y QUE DEPENDEN DEL MISMO INGRESO</span></ng-template>
        <h3><strong>Nota:</strong> Incluya a todos los familiares que dependen del mismo ingreso (Ejemplo: esposo/a, hijo/a, hermano/a, entre otros).</h3>
        <form [formGroup]="form | stepFormGroup : 2">
          <div class="mt-4">
            <button mat-raised-button type="button" class="green-button" (click)="addFamilyMemberWhoDependsOnTheSameIncome(true);">
              <mat-icon>add</mat-icon>
              Añadir Pariente
            </button>
            <div formArrayName="relativesWhoDependOnTheSameIncome" class="mt-3">
              <ng-container *ngFor="let item of relativesWhoDependOnTheSameIncomeFormArray.controls; let index = index; let first = first;">
                <h5 class="font-bold">Información de Pariente {{ index + 1 }}</h5>
                <div class="row" [formGroupName]="index">

                  <div class="col-4">
                    <mat-form-field appearance="outline">
                      <mat-label>Nombre y apellido del Pariente</mat-label>
                      <input matInput formControlName="familyMemberNames">
                    </mat-form-field>
                  </div>

                  <div class="col-2">
                    <mat-form-field appearance="outline">
                      <mat-label>Parentesco</mat-label>
                      <mat-select formControlName="relationship">

                        <ng-container>
                          <!--<mat-option value="">Yo Mismo</mat-option>-->
                          <mat-option *ngFor="let relationship of relationships; trackBy: trackByRelationshipId" [value]="relationship.relationShipID">
                            {{ relationship.relationName }}
                          </mat-option>
                        </ng-container>
                      </mat-select>
                    </mat-form-field>
                  </div>

                  <div class="col-2">
                    <mat-form-field appearance="outline">
                      <mat-label>Profesión/Ocupación</mat-label>
                      <mat-select formControlName="profession">
                        <mat-option *ngFor="let profession of professions; trackBy: trackByProfessionId" [value]="profession.professionID">
                          {{ profession.professionName }}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>

                  <div class="col-2">
                    <mat-form-field appearance="outline">
                      <mat-label>Estado Civil</mat-label>
                      <mat-select formControlName="civilStatus">
                        <mat-option *ngFor="let civilStatus of civilStatuses; trackBy: trackByCivilStatusId" [value]="civilStatus.civilStatusID">
                          {{ civilStatus.civilStatusDesc }}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>

                  <div class="col-2">
                    <mat-form-field appearance="outline">
                      <mat-label>Edad</mat-label>
                      <input
                        type="text"
                        matInput
                        mask="separator"
                        thousandSeparator=","
                        min="0"
                        max="110"
                        maxlength="3"
                        formControlName="age"
                        [allowNegativeNumbers]="false"
                        autocomplete="off">
                    </mat-form-field>
                    <mat-error *ngIf="item.hasError('ageError')">No puede ser mayor a 110 años ni menor de 1 año.</mat-error>
                  </div>

                  <div class="col-12">
                    <h3><strong>Nota:</strong> Si no existe un ingreso o gasto, coloque el valor 0.</h3>
                  </div>

                  <div class="col-2">
                    <mat-form-field appearance="outline">
                      <mat-label>Ingresos Mensuales</mat-label>
                      <input
                        type="text"
                        matInput
                        prefix="$ "
                        mask="separator.6"
                        thousandSeparator=","
                        decimalMarker="."
                        inputmode="numeric"
                        formControlName="income"
                        autocomplete="off">
                    </mat-form-field>
                    <mat-error *ngIf="item.hasError('incomeError')">Los ingresos no pueden ser menores que los gastos.</mat-error>
                  </div>

                  <div class="col-2">
                    <mat-form-field appearance="outline">
                      <mat-label>Gastos Mensuales</mat-label>
                      <input
                        type="text"
                        matInput
                        prefix="$ "
                        mask="separator.6"
                        thousandSeparator=","
                        decimalMarker="."
                        inputmode="numeric"
                        formControlName="expense"
                        autocomplete="off">
                    </mat-form-field>
                  </div>

                  <div class="col-1">
                    <button
                      type="button"
                      (click)="removeFamilyMemberWhoDependsOnTheStudent(index);"
                      mat-mini-fab class="remove-button"
                      matTooltipPosition="above"
                      matTooltip="Eliminar este registro">
                      <mat-icon>remove</mat-icon>
                    </button>
                  </div>
                </div>
              </ng-container>
            </div>
          </div>
        </form>
        <div class="d-flex justify-content-end" style="text-align: right;">
          <button mat-raised-button class="blue-button" matStepperPrevious>Regresar</button>&nbsp;
          <button mat-raised-button class="blue-button" matStepperNext>Siguiente</button>
        </div>
      </mat-step>

      <mat-step [stepControl]="form | stepFormGroup : 3" [editable]="true">
        <ng-template matStepLabel><span class="step-label">DATOS LABORALES</span></ng-template>

        <form [formGroup]="form | stepFormGroup : 3">
          <div class="mt-4">
            <div class="row">

              <div class="col-12 mb-3">
                <div class="d-flex align-items-center">
                  <mat-checkbox formControlName="isEmployed"><span style="font-size: 85%;">¿Actualmente está laborando?</span></mat-checkbox>
                </div>
              </div>

              <div class="col-4">
                <mat-form-field appearance="outline">
                  <mat-label>Nombre de la Empresa</mat-label>
                  <input matInput formControlName="companyName">
                </mat-form-field>
              </div>

              <div class="col-4">
                <mat-form-field appearance="outline">
                  <mat-label>Dirección de la Empresa</mat-label>
                  <input matInput formControlName="companyAddress">
                </mat-form-field>
              </div>

              <div class="col-4">
                <mat-form-field appearance="outline">
                  <mat-label>Puesto Laboral</mat-label>
                  <input matInput formControlName="jobTitle">
                </mat-form-field>
              </div>

              <div class="col-4">
                <mat-form-field appearance="outline">
                  <mat-label>Teléfono de la Empresa</mat-label>
                  <input matInput formControlName="phone" onKeypress="if (event.keyCode < 47 || event.keyCode > 57) event.returnValue = false;" maxlength="10">
                </mat-form-field>
              </div>

              <div class="col-4">
                <mat-form-field appearance="outline">
                  <mat-label>Horario de Trabajo</mat-label>
                  <input matInput formControlName="workingHours">
                </mat-form-field>
              </div>

              <div class="col-4">
                <mat-form-field appearance="outline">
                  <mat-label>Tiempo de Servicio (en meses)</mat-label>
                  <input
                    type="text"
                    matInput
                    mask="separator"
                    thousandSeparator=","
                    formControlName="serviceTime"
                    [allowNegativeNumbers]="false"
                    autocomplete="off">
                </mat-form-field>
              </div>
            </div>
            <div class="d-flex justify-content-end" style="text-align: right;">
              <button mat-raised-button class="blue-button" matStepperPrevious>Regresar</button>&nbsp;
              <button mat-raised-button class="blue-button" matStepperNext>Siguiente</button>
            </div>
          </div>
        </form>
      </mat-step>

      <mat-step [stepControl]="form | stepFormGroup : 4" [editable]="true">
        <ng-template matStepLabel><span class="step-label">DATOS ECONÓMICOS FAMILIARES &nbsp;&nbsp;<label style="color: white;">(PROMEDIO MENSUAL)</label></span></ng-template>

        <form [formGroup]="form | stepFormGroup : 4">
          <div class="mt-3">
            <div formArrayName="incomes">
              <h5 class="font-bold">Ingresos</h5>
              <div class="row mt-3">
                <div class="col-2" *ngFor="let item of incomesFormArray.controls; let index = index;" [formGroupName]="index">
                  <mat-form-field appearance="outline">
                    <mat-label>{{ item.value.name }}</mat-label>
                    <input
                      type="text"
                      matInput
                      prefix="$ "
                      mask="separator.6"
                      thousandSeparator=","
                      decimalMarker="."
                      inputmode="numeric"
                      formControlName="mount"
                      autocomplete="off">
                  </mat-form-field>
                </div>
              </div>
            </div>

            <div formArrayName="expenses">
              <h5 class="font-bold">Gastos</h5>
              <div class="row mt-3">
                <div class="col-2" *ngFor="let item of expensesFormArray.controls; let index = index;" [formGroupName]="index">
                  <mat-form-field appearance="outline">
                    <mat-label>{{ item.value.name }}</mat-label>
                    <input
                      type="text"
                      matInput
                      prefix="$ "
                      mask="separator.6"
                      thousandSeparator=","
                      decimalMarker="."
                      inputmode="numeric"
                      formControlName="mount"
                      autocomplete="off">
                  </mat-form-field>
                </div>
              </div>
            </div>
            <mat-error *ngIf="form.get('4').hasError('incomeError')">Los gastos no pueden ser mayores que los ingresos.</mat-error>

            <div class="d-flex justify-content-end" style="text-align: right;">
              <button mat-raised-button class="blue-button" matStepperPrevious>Regresar</button>&nbsp;
              <button mat-raised-button class="blue-button" matStepperNext>Siguiente</button>
            </div>
          </div>
        </form>
      </mat-step>

      <mat-step [stepControl]="form | stepFormGroup : 5" [editable]="true">
        <ng-template matStepLabel><span class="step-label">DATOS DE LA VIVIENDA (INCLUIDO EL ESTUDIANTE)</span></ng-template>

        <form [formGroup]="form | stepFormGroup : 5">
          <div class="mt-4">
            <div class="row">

              <div class="col-2">
                <mat-form-field appearance="outline">
                  <mat-label>Tipo de Vivienda</mat-label>
                  <mat-select formControlName="type">
                    <mat-option *ngFor="let type of housingTypes; trackBy: trackByHousingTypeId" [value]="type.housingTypeID">
                      {{ type.housingTypeName }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

              <div class="col-2">
                <mat-form-field appearance="outline">
                  <mat-label>Tipo de Ubicación</mat-label>
                  <mat-select formControlName="zone">
                    <mat-option *ngFor="let zone of zones; trackBy: trackByZoneId" [value]="zone.zoneID">
                      {{ zone.zoneDesc }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

              <div class="col-4">
                <mat-form-field appearance="outline">
                  <mat-label>Servicios</mat-label>
                  <mat-select formControlName="services" multiple>
                    <mat-option *ngFor="let service of basicServices; trackBy: trackByBasicServiceId" [value]="service.basicServiceID">{{ service.basicServiceName }}</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

              <div class="col-3">
                <mat-form-field appearance="outline">
                  <mat-label>Hombres Habitan</mat-label>
                  <input
                    type="text"
                    matInput
                    mask="separator"
                    thousandSeparator=","
                    formControlName="numberOfMenLivingThere"
                    [allowNegativeNumbers]="false"
                    autocomplete="off">
                </mat-form-field>
              </div>

              <div class="col-3">
                <mat-form-field appearance="outline">
                  <mat-label>Mujeres Habitan</mat-label>
                  <input
                    type="text"
                    matInput
                    mask="separator"
                    thousandSeparator=","
                    formControlName="numberOfWomenLivingThere"
                    [allowNegativeNumbers]="false"
                    autocomplete="off">
                </mat-form-field>
              </div>
            </div>
            <div class="d-flex justify-content-end" style="text-align: right;">
              <button mat-raised-button class="blue-button" matStepperPrevious>Regresar</button>&nbsp;
              <button mat-raised-button class="blue-button" matStepperNext>Siguiente</button>
            </div>
          </div>
        </form>
      </mat-step>

      <mat-step [stepControl]="form | stepFormGroup : 6" [editable]="true">
        <ng-template matStepLabel><span class="step-label">INFORMACIÓN SOBRE SALUD Y NATALIDAD</span></ng-template>

        <form [formGroup]="form | stepFormGroup : 6">
          <div class="mt-4">
            <div class="row">
              <div class="col-6">
                <mat-form-field appearance="outline">
                  <mat-label>En General, Usted Considera que su Salud es</mat-label>
                  <mat-select formControlName="healthTypeID">
                    <mat-option *ngFor="let type of healthTypes; trackBy: trackByHealthTypeId" [value]="type.healthTypeID">
                      {{ type.healthTypeName }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>

            <h5 class="font-bold">Información del Número de Hijos del Estudiante</h5>
            <div class="row">
              <div class="col-3">
                <mat-form-field appearance="outline">
                  <mat-label>Número de Hijos</mat-label>
                  <input
                    type="text"
                    matInput
                    mask="separator"
                    thousandSeparator=","
                    formControlName="numberOfChildren"
                    [allowNegativeNumbers]="false"
                    min="1"
                    max="25"
                    maxlength="2"
                    autocomplete="off">
                </mat-form-field>
                <mat-error *ngIf="healthFormGroup.hasError('sumError')">La suma de hijos hombres y mujeres debe resultar el número de hijos.</mat-error>
              </div>
              <div class="col-3">
                <mat-form-field appearance="outline">
                  <mat-label>Hombres</mat-label>
                  <input
                    type="text"
                    matInput
                    min="0"
                    max="25"
                    maxlength="2"
                    mask="separator"
                    thousandSeparator=","
                    formControlName="numberOfMen"
                    [allowNegativeNumbers]="false"
                    autocomplete="off">
                </mat-form-field>
              </div>
              <div class="col-3">
                <mat-form-field appearance="outline">
                  <mat-label>Mujeres</mat-label>
                  <input
                    type="text"
                    matInput
                    mask="separator"
                    min="0"
                    max="25"
                    maxlength="2"
                    thousandSeparator=","
                    formControlName="numberOfWomen"
                    [allowNegativeNumbers]="false"
                    autocomplete="off">
                </mat-form-field>
              </div>
            </div>

            <div class="d-flex justify-content-end" style="text-align: right;">
              <button mat-raised-button class="blue-button" matStepperPrevious>Regresar</button>&nbsp;
              <button mat-raised-button class="blue-button" matStepperNext>Siguiente</button>
            </div>
          </div>
        </form>
      </mat-step>


      <mat-step [stepControl]="form | stepFormGroup : 7" [editable]="true">
        <ng-template matStepLabel><span class="step-label">EDUCACIÓN</span></ng-template>

        <form [formGroup]="form | stepFormGroup : 7">
          <div class="mt-4">
            <div formArrayName="academicDegree">
              <div class="row">
                <div class="col-3" *ngFor="let item of academicDegreeFormArray.controls; let index = index;" [formGroupName]="index">
                  <mat-form-field appearance="outline">
                    <mat-label>{{ item.value.name }}</mat-label>
                    <input type="text" onkeypress='return ((event.charCode >= 65 && event.charCode <= 90) || (event.charCode >= 97 && event.charCode <= 122) || (event.charCode == 32))' matInput formControlName="educationSkillName">
                  </mat-form-field>
                </div>
              </div>
            </div>
            <div class="row">
              <mat-checkbox class="example-margin"
              (change)="changeStudentCommitment($event)"
                  [checked]="studentCommitment">
                  Yo {{ getFullNamePerson() }} con cédula de Identidad {{ infoPerson.identity }}, me comprometo con el Instituto Superior Tecnológico ITCA, en calidad de estudiante a sujetarme a las disposiciones
                  reglamentarias vigentes entendiendo las repercusiones implícitas en el incumplimiento en las mismas.
                  Me ratifico en el contenido de esta acta de compromiso, Ibarra {{ getDate() }}.
            </mat-checkbox>
            </div>
            <div class="d-flex justify-content-end" style="text-align: right;">
              <button [disabled]="!studentCommitment" mat-raised-button (click)="postAll();" class="blue-button">Enviar Formulario</button>
            </div>
          </div>
        </form>
      </mat-step>
    </mat-stepper>
</div>
