<div style="display: flex; justify-content: end; align-items: center; background: #014898;" class="p-2 mb-3">
  <mat-icon style="cursor: pointer; color: white;" [matDialogClose]="false" class="white-icon" matRipple>close</mat-icon>
</div>

<mat-dialog-content>
  <h3 class="mb-3 text-center font-18" style="font-weight: 500;">SOLICITUD DE DOCUMENTO</h3>
  <div *ngIf="isLoadingInfo; else requestPublicationForm">
    <spinner-loader></spinner-loader>
  </div>
  <ng-template #requestPublicationForm>
    <form [formGroup]="form">
      <div class="container-fluid">
        <div class="row pt-3">
          <!-- <div class="col-3" *ngIf="user.rolName === ROL.ADMIN || user.rolName === ROL.LIBRARIAN || user.rolName === ROL.TEACHER"> -->
          <div class="col-3" *ngIf="rolIDSession === '16'">
            <mat-form-field appearance="outline">
              <mat-label>Tipo de Solicitante</mat-label>
              <mat-select formControlName="applicantType" (selectionChange)="onChangeApplicantType($event);">
                <mat-option *ngFor="let item of applicantTypes" [value]="item.applicantTypeID">
                  {{ item.applicantTypeDesc }}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="form.hasError('required', 'applicantType');">Este campo es requerido</mat-error>
            </mat-form-field>
          </div>
          <!-- <div class="col-4" *ngIf="user.rolName === ROL.ADMIN || user.rolName === ROL.LIBRARIAN || user.rolName === ROL.TEACHER"> -->
          <div class="col-4" *ngIf="rolIDSession === '16'">
            <div class="d-flex justify-content-between">
              <div class="w-100">
                <mat-form-field>
                  <mat-label>Buscar Solicitante por su Identificación</mat-label>
                  <input matInput formControlName="searchApplicantIdentification" autocomplete="off">
                  <mat-error *ngIf="form.hasError('required', 'applicantId');">Información del solicitante es requerida.</mat-error>
                </mat-form-field>
              </div>
              <div style="width: 60px;">
                <button class="w-100 ml-2" type="button" mat-raised-button color="primary" (click)="searchApplicantById();">
                  <mat-icon class="m-0">search</mat-icon>
                </button>
              </div>
            </div>
          </div>
          <div class="col-3">
            <mat-form-field appearance="outline">
              <mat-label>Prenda</mat-label>
              <mat-select formControlName="depositType">
                <mat-option *ngFor="let item of depositTypes" [value]="item.warrantyID">
                  {{ item.warrantyDesc }}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="form.hasError('required', 'depositType');">Este campo es requerido</mat-error>
            </mat-form-field>
          </div>
        </div>
        <!-- <div class="row" *ngIf="user.rolName === ROL.ADMIN || user.rolName === ROL.LIBRARIAN || user.rolName === ROL.TEACHER"> -->
        <div class="row" *ngIf="rolIDSession === '16'">
          <div class="col-4">
            <mat-form-field appearance="outline">
              <mat-label>Observación</mat-label>
              <textarea matInput formControlName="observation"></textarea>
            </mat-form-field>
          </div>
        </div>
        <!-- <div *ngIf="user.rolName === ROL.ADMIN || user.rolName === ROL.LIBRARIAN || user.rolName === ROL.TEACHER"> -->
        <div *ngIf="rolIDSession === '16'">
          <div>
            <h3>Información del solicitante</h3>
          </div>
          <div class="row applicant-info">
            <div class="col-6">
              <p><span>Nombres: </span> {{ applicant?.names || 'N/A' }}</p>
            </div>
            <div class="col-6">
              <p><span>Apellido: </span> {{ applicant?.lastName || 'N/A' }}</p>
            </div>
            <div class="col-6">
              <p><span>Teléfono: </span> {{ applicant?.numberPhone || 'N/A' }}</p>
            </div>
            <div class="col-6">
              <p><span>Correo: </span> {{ applicant?.emailDesc || 'N/A' }}</p>
            </div>
            <div class="col-6">
              <p><span>Carrera: </span> {{ applicant?.careerDesc || 'N/A' }}</p>
            </div>
            <div class="col-6">
              <p><span>Modalidad: </span> {{ applicant?.modalityName || 'N/A' }}</p>
            </div>
            <div class="col-6">
              <p><span>Paralelo: </span> {{ applicant?.parellel || 'N/A' }}</p>
            </div>
            <div class="col-6">
              <p><span>Oficina: </span> {{ applicant?.officeLocation || 'N/A' }}</p>
            </div>
            <div class="col-6">
              <p><span>Categoría del Docente: </span> {{ applicant?.teacherCategory || 'N/A' }}</p>
            </div>
            <div class="col-6">
              <p><span>Tipo de Dedicación: </span> {{ applicant?.dedicationsDesc || 'N/A' }}</p>
            </div>
          </div>
        </div>

        <div class="mt-3">
          <h3>Documentos Solicitados ({{ requestedPublicationsFormArray.length }})</h3>
        </div>
        <div class="row" formArrayName="requestedPublications">
          <div class="col-12 row" *ngFor="let requestedPublication of requestedPublicationsFormArray.controls; let indexRequestedPublication = index">
            <ng-container [formGroupName]="indexRequestedPublication">
              <div class="col-3 d-flex align-self-center">
                <p class="m-0 font-14" style="font-weight: 500; letter-spacing: 0">{{ requestedPublication.value.publication.title }}
                  <small style="font-weight: 400">{{ requestedPublication.value.publication.edition }}</small>
                </p>
              </div>
              <div class="col-2">
                <mat-form-field>
                  <mat-label>Fecha de Entrega</mat-label>
                  <input [min]="minDate" [max]="maxDate" matInput [matDatepicker]="picker" formControlName="dueDate">
                  <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                  <mat-datepicker #picker></mat-datepicker>
                </mat-form-field>
              </div>
              <div class="col-2">
                <mat-form-field>
                  <mat-label>Hora de Entrega</mat-label>
                  <input type="time" matInput formControlName="dueHour">
                </mat-form-field>
              </div>
              <!-- <div class="col-3" *ngIf="user.rolName === ROL.ADMIN || user.rolName === ROL.LIBRARIAN || user.rolName === ROL.TEACHER"> -->
              <div class="col-3" *ngIf="rolIDSession === '16'">
                <mat-form-field>
                  <mat-label>Estado de Documento</mat-label>
                  <mat-select formControlName="condition">
                    <mat-option *ngFor="let publicationCondition of publicationsCondition;" [value]="publicationCondition.physicalQualityID">
                      <span>{{ publicationCondition.physicalQualityDesc }}</span>
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
              <div class="col-1">
                <button type="button" mat-icon-button (click)="removePublication(indexRequestedPublication);">
                  <mat-icon class="red-icon">delete</mat-icon>
                </button>
              </div>
            </ng-container>
          </div>
        </div>
      </div>
    </form>
  </ng-template>
  <!--<p #errorParagraph style="background: #f44336; color: white; display: none; font-size: 14px; padding: 5px 10px; border-radius: 4px;"></p>-->
</mat-dialog-content>

<mat-dialog-actions class="justify-content-between">
  <div *ngIf="!isLoadingInfo" class="d-flex no-block w-100 justify-content-between">
    <div class="pl-3">
      <button
        mat-raised-button
        style="letter-spacing: 0;" color="warn" [mat-dialog-close]="false">
        Cerrar
      </button>
    </div>
    <div class="pr-3">
      <button
        mat-raised-button
        (click)="sendForm();"
        style="letter-spacing: 0;" color="primary">
        <!-- {{ user.rolName === ROL.ADMIN || user.rolName === ROL.LIBRARIAN ? 'Registrar Solicitud' : 'Solicitar Publicaciones' }} -->
        {{ rolIDSession === '16' ? 'Registrar Solicitud' : 'Solicitar Publicaciones' }}
      </button>
    </div>
  </div>
</mat-dialog-actions>
